# Filename: {{ output_path }}
# Autorestic configuration for backing up {{ location_name }}
# Generated by Scaffoldr on {{ generation_timestamp }}

version: 2

locations:
  {{ location_name }}:
    from: {{ location_from }}
    to:
{%- if location_to is string and ',' in location_to %}
  {%- for t in location_to.split(',') %}
      - {{ t.strip() }}
  {%- endfor %}
{%- elif location_to is iterable and location_to is not string %}
  {%- for t in location_to %}
      - {{ t }}
  {%- endfor %}
{%- else %}
      - {{ location_to }}
{%- endif %}

    hooks:
      before:
        - echo "Starting '{{ location_name }}' backup."
{%- if hook_before %}
        - "{{ hook_before }}"
{%- endif %}
      success:
        - echo "Completed '{{ location_name }}' backup."
{%- if hook_success %}
        - "{{ hook_success }}"
{%- endif %}
      failure:
        - echo "Failed '{{ location_name }}' backup."
{%- if hook_failure %}
        - "{{ hook_failure }}"
{%- endif %}

    forget:
      keep-last: {{ forget_keep_last }}
      keep-daily: {{ forget_keep_daily }}
      keep-weekly: {{ forget_keep_weekly }}
      keep-monthly: {{ forget_keep_monthly }}

backends:
  {{ backend_name }}:
    type: {{ backend_type }}
    path: {{ backend_path }}
{%- if backend_type == 's3' %}
    env:
      AWS_ACCESS_KEY_ID: {{ backend_env_aws_access_key_id }}
      AWS_SECRET_ACCESS_KEY: {{ backend_env_aws_secret_access_key }}
{%- endif %}
    key: {{ backend_key }}
    requireKey: true
